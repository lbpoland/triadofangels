<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Explore albums from Triad of Angels and ToA Studios artists." />
  <meta name="keywords" content="Triad of Angels, ToA Studios, music, albums" />
  <meta name="author" content="Triad of Angels" />
  <meta property="og:title" content="Album Details | Triad of Angels & ToA Studios" />
  <meta property="og:description" content="Explore albums from Triad of Angels and ToA Studios artists." />
  <meta property="og:image" content="/assets/images/og-banner.jpg" />
  <meta property="og:url" content="https://www.triadofangels.com/album.html" />
  <meta property="og:type" content="website" />
  <link rel="icon" type="image/png" href="assets/images/favicon.png">
  <link rel="apple-touch-icon" href="assets/images/apple-touch-icon.png">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/chatbot.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <title>Album Details | Triad of Angels & ToA Studios</title>
  <style>
    /* Existing styles */
    body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      background: transparent;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.9) 0%,
        rgba(0, 0, 0, 0.3) 50%,
        rgba(0, 0, 0, 0) 100%
      ),
      linear-gradient(
        to right,
        rgba(241, 196, 15, 0.08) 0%,
        rgba(0, 0, 0, 0.5) 50%,
        rgba(241, 196, 15, 0.08) 100%
      );
      z-index: -1;
      pointer-events: none;
    }

    .album-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -2;
      pointer-events: none;
      filter: blur(20px);
    }

    .album-container {
      position: relative;
      color: #f5f5f5;
      font-family: 'Montserrat', sans-serif;
      min-height: 100vh;
      z-index: 0;
    }

    .album-hero {
      position: relative;
      min-height: 100vh;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0 40px;
      box-sizing: border-box;
    }

    .album-hero-content {
      position: relative;
      z-index: 2;
      max-width: 1200px;
      padding: 50px;
      background: rgba(15, 15, 15, 0.6);
      border-radius: 35px;
      box-shadow: 0 0 80px rgba(241, 196, 15, 0.1), inset 0 0 25px rgba(241, 196, 15, 0.05);
      border: 2px solid rgba(241, 196, 15, 0.15);
      backdrop-filter: blur(20px);
    }

    .album-hero-content h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 5rem;
      font-weight: 900;
      letter-spacing: 5px;
      text-transform: uppercase;
      background: linear-gradient(45deg, #f1c40f, #ffeb3b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(241, 196, 15, 0.6), 0 0 60px rgba(241, 196, 15, 0.4);
      margin-bottom: 30px;
      animation: glow 5s ease-in-out infinite alternate;
    }

    @keyframes glow {
      0% { text-shadow: 0 0 30px rgba(241, 196, 15, 0.6), 0 0 60px rgba(241, 196, 15, 0.4); }
      100% { text-shadow: 0 0 40px rgba(241, 196, 15, 0.8), 0 0 80px rgba(241, 196, 15, 0.6); }
    }

    .album-hero-content p {
      font-size: 2rem;
      color: #e8e8e8;
      font-weight: 300;
      letter-spacing: 2px;
      text-shadow: 0 4px 10px rgba(0, 0, 0, 0.9);
      font-style: italic;
    }

    .album-main {
      max-width: 1300px;
      margin: 0 auto;
      padding: 120px 40px;
      position: relative;
      z-index: 2;
      background: rgba(0, 0, 0, 0.75);
    }

    .album-details {
      display: flex;
      flex-wrap: wrap;
      gap: 70px;
      background: rgba(20, 20, 20, 0.9);
      border-radius: 40px;
      padding: 70px;
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.9), inset 0 0 35px rgba(241, 196, 15, 0.02);
      border: 2px solid rgba(241, 196, 15, 0.1);
      margin-bottom: 70px;
      opacity: 0;
      transform: translateY(50px);
      animation: fadeInUp 1s ease-out forwards;
    }

    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(50px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .album-cover {
      flex: 1;
      min-width: 500px;
      text-align: center;
      position: relative;
    }

    .album-cover img {
      width: 100%;
      max-width: 550px;
      height: auto;
      border-radius: 35px;
      box-shadow: 0 25px 60px rgba(0, 0, 0, 0.9), 0 0 50px rgba(241, 196, 15, 0.1);
      transition: transform 0.8s ease, box-shadow 0.8s ease;
      border: 3px solid rgba(241, 196, 15, 0.2);
      object-fit: cover;
      loading: lazy;
    }

    .album-cover img:hover {
      transform: scale(1.02);
      box-shadow: 0 35px 80px rgba(0, 0, 0, 0.95), 0 0 60px rgba(241, 196, 15, 0.25);
    }

    .album-info {
      flex: 2;
      min-width: 500px;
    }

    .album-info h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3.5rem;
      font-weight: 800;
      color: #f1c40f;
      margin-bottom: 35px;
      text-transform: uppercase;
      letter-spacing: 5px;
      text-shadow: 0 0 30px rgba(241, 196, 15, 0.5);
    }

    .album-info p {
      font-size: 1.4rem;
      color: #dbdbdb;
      margin: 20px 0;
      line-height: 2;
      font-weight: 300;
    }

    .album-info p strong {
      color: #f5f5f5;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    #album-description {
      margin-top: 30px;
      font-size: 1.5rem;
      color: #e8e8e8;
      font-style: italic;
      background: rgba(241, 196, 15, 0.02);
      padding: 30px;
      border-radius: 15px;
      border-left: 5px solid #f1c40f;
      line-height: 2;
      box-shadow: inset 0 0 25px rgba(0, 0, 0, 0.3);
    }

    .streaming-links {
      background: rgba(20, 20, 20, 0.9);
      border-radius: 40px;
      padding: 70px;
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.9), inset 0 0 35px rgba(241, 196, 15, 0.02);
      border: 2px solid rgba(241, 196, 15, 0.1);
      text-align: center;
      margin-bottom: 70px;
      opacity: 0;
      transform: translateY(50px);
      animation: fadeInUp 1s ease-out forwards 0.2s;
    }

    .streaming-links h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3.5rem;
      font-weight: 800;
      color: #f1c40f;
      margin-bottom: 50px;
      text-transform: uppercase;
      letter-spacing: 5px;
      text-shadow: 0 0 30px rgba(241, 196, 15, 0.5);
    }

    .link-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }

    .link-tab {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 28px;
      background: linear-gradient(45deg, #f1c40f, #ffeb3b);
      color: #0a0a0a;
      text-decoration: none;
      border-radius: 30px;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(241, 196, 15, 0.2), inset 0 0 5px rgba(255, 235, 59, 0.1);
      border: 1px solid rgba(241, 196, 15, 0.4);
      letter-spacing: 1px;
    }

    .link-tab:hover {
      background: linear-gradient(45deg, #ffeb3b, #f1c40f);
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(241, 196, 15, 0.4), inset 0 0 10px rgba(255, 235, 59, 0.2);
    }

    .link-tab:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(241, 196, 15, 0.5);
    }

    .music-player {
      background: rgba(20, 20, 20, 0.9);
      border-radius: 40px;
      padding: 70px;
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.9), inset 0 0 35px rgba(241, 196, 15, 0.02);
      border: 2px solid rgba(241, 196, 15, 0.1);
      text-align: center;
      margin-bottom: 70px;
      opacity: 0;
      transform: translateY(50px);
      animation: fadeInUp 1s ease-out forwards 0.4s;
    }

    .music-player h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3.5rem;
      font-weight: 800;
      color: #f1c40f;
      margin-bottom: 50px;
      text-transform: uppercase;
      letter-spacing: 5px;
      text-shadow: 0 0 30px rgba(241, 196, 15, 0.5);
    }

    .music-player iframe {
      width: 100%;
      max-width: 600px;
      height: 600px;
      border: none;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      background: rgba(0, 0, 0, 0.9);
    }

    .music-player p {
      font-size: 1.4rem;
      color: #dbdbdb;
      font-style: italic;
      margin-top: 30px;
    }

    .error-section {
      background: rgba(20, 20, 20, 0.9);
      border-radius: 40px;
      padding: 70px;
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.9);
      border: 2px solid rgba(241, 196, 15, 0.1);
      text-align: center;
      max-width: 900px;
      margin: 50px auto;
      opacity: 0;
      transform: translateY(50px);
      animation: fadeInUp 1s ease-out forwards;
    }

    .error-section h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3rem;
      font-weight: 800;
      color: #f1c40f;
      margin-bottom: 30px;
      text-transform: uppercase;
      letter-spacing: 4px;
      text-shadow: 0 0 30px rgba(241, 196, 15, 0.5);
    }

    .error-section p {
      font-size: 1.4rem;
      color: #dbdbdb;
      line-height: 2;
    }

    /* Comments Section Styles */
    .comments-section {
      background: rgba(20, 20, 20, 0.9);
      border-radius: 40px;
      padding: 70px;
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.9), inset 0 0 35px rgba(241, 196, 15, 0.02);
      border: 2px solid rgba(241, 196, 15, 0.1);
      text-align: left;
      margin-bottom: 70px;
      opacity: 0;
      transform: translateY(50px);
      animation: fadeInUp 1s ease-out forwards 0.6s;
    }

    .comments-section h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3.5rem;
      font-weight: 800;
      color: #f1c40f;
      margin-bottom: 50px;
      text-transform: uppercase;
      letter-spacing: 5px;
      text-shadow: 0 0 30px rgba(241, 196, 15, 0.5);
      text-align: center;
    }

    .comment-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 40px;
    }

    .comment-form textarea {
      width: 100%;
      min-height: 100px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(241, 196, 15, 0.3);
      border-radius: 10px;
      color: #e8e8e8;
      font-size: 1.2rem;
      resize: vertical;
    }

    .comment-form textarea:focus {
      outline: none;
      border-color: #f1c40f;
      box-shadow: 0 0 10px rgba(241, 196, 15, 0.3);
    }

    .comment-form button {
      padding: 10px 20px;
      background: linear-gradient(45deg, #f1c40f, #ffeb3b);
      color: #0a0a0a;
      border: none;
      border-radius: 20px;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s ease;
      align-self: flex-end;
    }

    .comment-form button:hover {
      background: linear-gradient(45deg, #ffeb3b, #f1c40f);
      transform: scale(1.05);
    }

    .comment-form button:disabled {
      background: #555;
      cursor: not-allowed;
      transform: none;
      opacity: 0.5;
      position: relative;
    }

    /* Tooltip for Disabled Button */
    .comment-form button:disabled:hover::after {
      content: "You need to sign in to comment";
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(241, 196, 15, 0.9);
      color: #0a0a0a;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.9rem;
      white-space: nowrap;
      z-index: 10;
    }

    /* Arrow for the tooltip bubble */
    .comment-form button:disabled:hover::before {
      content: "";
      position: absolute;
      bottom: 90%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: rgba(241, 196, 15, 0.9);
      z-index: 10;
    }

    .comment-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .comment {
      background: rgba(15, 15, 15, 0.8);
      padding: 20px;
      border-radius: 15px;
      border: 1px solid rgba(241, 196, 15, 0.2);
      position: relative;
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .comment-header span {
      font-size: 1.1rem;
      color: #f1c40f;
      font-weight: 600;
    }

    .comment-header .timestamp {
      font-size: 0.9rem;
      color: #aaa;
    }

    .comment-content {
      font-size: 1.2rem;
      color: #e8e8e8;
      line-height: 1.6;
      margin-bottom: 10px;
    }

    .comment-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .comment-actions button {
      background: none;
      border: none;
      color: #f1c40f;
      font-size: 1rem;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .comment-actions button:hover {
      color: #ffeb3b;
    }

    .comment-actions button:disabled {
      color: #555;
      cursor: not-allowed;
    }

    .comment-actions span {
      font-size: 1rem;
      color: #e8e8e8;
    }

    .comment-actions .admin-only {
      display: none;
    }

    .comment-actions.admin-view .admin-only {
      display: inline;
    }

    @media (max-width: 1024px) {
      .album-hero {
        min-height: 90vh;
      }

      .album-hero-content h1 {
        font-size: 4.5rem;
      }

      .album-hero-content p {
        font-size: 1.8rem;
      }

      .album-details {
        flex-direction: column;
        align-items: center;
        padding: 60px;
        gap: 60px;
      }

      .album-cover img {
        max-width: 500px;
      }

      .album-info h2 {
        font-size: 3rem;
      }

      .album-info p {
        font-size: 1.3rem;
      }

      #album-description {
        font-size: 1.4rem;
      }

      .streaming-links, .music-player, .comments-section {
        padding: 60px;
      }

      .streaming-links h2, .music-player h2, .comments-section h2 {
        font-size: 3rem;
      }
    }

    @media (max-width: 768px) {
      .album-hero {
        min-height: 80vh;
      }

      .album-hero-content {
        padding: 40px;
        border-radius: 30px;
      }

      .album-hero-content h1 {
        font-size: 4rem;
      }

      .album-hero-content p {
        font-size: 1.6rem;
      }

      .album-details {
        padding: 50px;
        gap: 50px;
      }

      .album-cover img {
        max-width: 450px;
      }

      .album-info h2 {
        font-size: 2.5rem;
      }

      .album-info p {
        font-size: 1.2rem;
      }

      #album-description {
        font-size: 1.3rem;
        padding: 25px;
      }

      .streaming-links, .music-player, .comments-section {
        padding: 50px;
      }

      .streaming-links h2, .music-player h2, .comments-section h2 {
        font-size: 2.5rem;
      }

      .link-tab {
        padding: 8px 24px;
        font-size: 0.9rem;
      }

      .music-player iframe {
        height: 500px;
      }
    }

    @media (max-width: 480px) {
      .album-hero {
        min-height: 70vh;
      }

      .album-hero-content h1 {
        font-size: 3.5rem;
      }

      .album-hero-content p {
        font-size: 1.4rem;
      }

      .album-details {
        padding: 40px;
        gap: 40px;
      }

      .album-cover img {
        max-width: 400px;
      }

      .album-info h2 {
        font-size: 2rem;
      }

      .album-info p {
        font-size: 1.1rem;
      }

      #album-description {
        font-size: 1.2rem;
        padding: 20px;
      }

      .streaming-links, .music-player, .comments-section {
        padding: 40px;
      }

      .streaming-links h2, .music-player h2, .comments-section h2 {
        font-size: 2rem;
      }

      .link-tab {
        padding: 6px 20px;
        font-size: 0.8rem;
      }

      .music-player iframe {
        height: 400px;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .link-tab, .album-cover img, .album-details, .streaming-links, .music-player, .comments-section {
        transition: none;
        animation: none;
      }

      .link-tab:hover, .album-cover img:hover {
        transform: none;
      }

      .album-hero-content h1 {
        animation: none;
        text-shadow: 0 0 30px rgba(241, 196, 15, 0.6);
      }
    }
  </style>
</head>

<body class="album-page">
  <!-- Album Background -->
  <img id="album-background" class="album-background" alt="Blurred album cover background" loading="lazy" />

  <!-- ========== NAVIGATION BAR WITH INTEGRATED LOGIN UI ========== -->
  <header role="banner">
    <nav role="navigation" aria-label="Main site navigation">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="music.html">Music</a></li>
        <li><a href="visual.html">Visual</a></li>
        <li><a href="games.html">Games</a></li>
        <li><a href="apps.html">Apps</a></li>
        <li><a href="merch.html">Merch</a></li>
        <li><a href="publishing.html">Publishing</a></li>
        <li><a href="digital-store.html">Digital Store</a></li>
        <li><a href="contact.html">Contact</a></li>
        <!-- Integrated Login UI -->
        <li id="auth-nav-item">
          <div id="global-auth-ui">
            <span id="global-user-name">Guest</span>
            <button id="global-login-btn">Sign In</button>
            <button id="global-logout-btn">Logout</button>
          </div>
        </li>
      </ul>
    </nav>
  </header>

  <div class="album-container">
    <!-- Album Hero Section -->
    <section class="album-hero" aria-label="Album hero section">
      <div class="album-hero-content">
        <h1 id="album-title">Loading...</h1>
        <p id="album-subtitle">A Masterpiece by Triad of Angels & ToA Studios</p>
      </div>
    </section>

    <main class="album-main">
      <!-- Album Details -->
      <section class="album-details" aria-label="Album details">
        <div class="album-cover">
          <img id="album-cover" alt="Album cover" loading="lazy" />
        </div>
        <div class="album-info">
          <h2 id="album-info-title">Loading...</h2>
          <p id="album-artist"><strong>Artist:</strong> Loading...</p>
          <p id="album-tracks"><strong>Tracks:</strong> Loading...</p>
          <p id="album-genre"><strong>Genre:</strong> Loading...</p>
          <p id="album-year"><strong>Release Date:</strong> Loading...</p>
          <p id="album-description">Loading...</p>
        </div>
      </section>

      <!-- Streaming Links -->
      <section class="streaming-links" aria-label="Streaming and purchase links">
        <h2>Stream or Purchase</h2>
        <div id="link-tabs" class="link-tabs"></div>
      </section>

      <!-- Music Player -->
      <section class="music-player" aria-label="Music player embed">
        <h2>Listen Now</h2>
        <div id="music-player-embed"></div>
      </section>

      <!-- Comments Section -->
      <section class="comments-section" aria-label="Album comments">
        <h2>Comments</h2>
        <div class="comment-form">
          <textarea id="comment-input" placeholder="Write your comment here..." aria-label="Comment input" disabled></textarea>
          <button id="submit-comment" disabled>Post Comment</button>
        </div>
        <div class="comment-list" id="comment-list"></div>
      </section>
    </main>
  </div>

  <!-- Footer -->
  <footer role="contentinfo" style="margin-top: 60px; text-align: center; font-size: 0.9em; color: #aaa; padding: 30px 20px;">
    <p>¬© 2025 ToA Studios & Triad of Angels. All rights reserved.</p>
    <p>
      <a href="index.html">Home</a> |
      <a href="terms.html">Terms & Conditions</a> |
      <a href="privacy.html">Privacy Policy</a> |
      <a href="contact.html">Contact</a>
    </p>
    <div style="width: 60%; margin: 20px auto; border-top: 1px solid #555;"></div>
    <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 15px;" aria-label="Social media links">
      <a href="https://www.tiktok.com/@triadofangels" target="_blank" rel="noopener" aria-label="TikTok" style="display: inline-flex; align-items: center; gap: 8px; color: #f1c40f; text-decoration: none; font-size: 0.9em;">
        <img src="assets/icons/tiktok-icon.svg" alt="TikTok icon" style="width: 24px; height: 24px;" loading="lazy">
        <span>TikTok</span>
      </a>
      <a href="https://www.instagram.com/triadofangels/" target="_blank" rel="noopener" aria-label="Instagram" style="display: inline-flex; align-items: center; gap: 8px; color: #f1c40f; text-decoration: none; font-size: 0.9em;">
        <img src="assets/icons/instagram-icon.svg" alt="Instagram icon" style="width: 24px; height: 24px;" loading="lazy">
        <span>Instagram</span>
      </a>
      <a href="https://www.youtube.com/@triadofangels_new" target="_blank" rel="noopener" aria-label="YouTube" style="display: inline-flex; align-items: center; gap: 8px; color: #f1c40f; text-decoration: none; font-size: 0.9em;">
        <img src="assets/icons/youtube-icon.svg" alt="YouTube icon" style="width: 24px; height: 24px;" loading="lazy">
        <span>YouTube</span>
      </a>
      <a href="https://www.facebook.com/triadofangels" target="_blank" rel="noopener" aria-label="Facebook" style="display: inline-flex; align-items: center; gap: 8px; color: #f1c40f; text-decoration: none; font-size: 0.9em;">
        <img src="assets/icons/facebook-icon.svg" alt="Facebook icon" style="width: 24px; height: 24px;" loading="lazy">
        <span>Facebook</span>
      </a>
      <a href="https://x.com/triadofangels" target="_blank" rel="noopener" aria-label="X (Twitter)" style="display: inline-flex; align-items: center; gap: 8px; color: #f1c40f; text-decoration: none; font-size: 0.9em;">
        <img src="assets/icons/x-icon.svg" alt="X (Twitter) icon" style="width: 24px; height: 24px;" loading="lazy">
        <span>X (Twitter)</span>
      </a>
    </div>
  </footer>

  <!-- Chatbot HTML (Text-only helpdesk) -->
  <div id="toa-chatbot">
    <div id="chatbot-icon" title="Need help? Chat with us!" role="button" tabindex="0" aria-label="Toggle chatbot window">
      <img src="assets/images/chatbot.png" alt="Triad of Angels Chatbot Icon" width="48" height="48" loading="lazy">
    </div>
    <div id="chatbot-window" class="hidden" role="dialog" aria-label="Triad of Angels Helpdesk">
      <div id="chatbot-header" style="text-align: center">
        <strong>Triad of Angels Helpdesk</strong>
        <button id="chatbot-close-button" aria-label="Close Chat Window" class="close-button">[x]</button>
      </div>
      <div id="chatbot-body" role="log" aria-live="polite"></div>
      <div id="chatbot-input">
        <input type="text" id="user-input" placeholder="Ask me anything..." aria-label="Chat input">
        <button id="chatbot-send-button" aria-label="Send message">Send</button>
        <button id="chatbot-reset-button" title="Reset Conversation">Reset Chat</button>
      </div>
    </div>
  </div>

  <!-- Error Toast -->
  <div id="global-error-toast" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #ff4444; color: #fff; padding: 10px 20px; border-radius: 5px; z-index: 2000;"></div>

  <!-- Scripts -->
  <script src="js/chatbot.js?v=2"></script>
  <script src="js/chatbot-persist.js?v=2"></script>
  <script type="module">
    import './js/firebase-init.js?v=2';
    import './js/auth.js?v=2';
  </script>

<script type="module">
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { auth, db } from './js/firebase-init.js';
  import './js/auth.js';

  // Album data
  const albums = [
    {
      id: "wings-of-fire",
      title: "Wings of Fire",
      artist: "Triad of Angels",
      genre: "Cinematic Pop",
      year: 2024,
      cover: "assets/images/albums/wingsoffire-album.png",
      tracks: ["Ignite the Sky", "Eternal Flame", "Rise Above"],
      links: {
        spotify: "https://open.spotify.com/album/4K83YJEeETmcybKtQ1LP5l?si=fOFELopLS9W3eLOSR8x5tA",
        appleMusic: "https://music.apple.com/us/album/wings-of-fire-ep/1812163266",
        amazonMusic: "https://music.amazon.com/albums/B0F79L26WV?marketplaceId=A15PK738MTQHSO&musicTerritory=AU&ref=dm_sh_LjFRykAfbo5PSnB7mT8yMjN2a",
        iHeartRadio: "https://www.iheart.com/artist/triad-of-angels-46655903/albums/wings-of-fire-326706390/",
        boomplay: "https://www.boomplay.com/albums/110140275?from=search&srModel=COPYLINK&srList=WEB",
        deezer: "https://dzr.page.link/SvK8hbw8DH1q33xXA",
        youTubeMusic: "https://music.youtube.com/playlist?list=OLAK5uy_kpbLV2nL-Ryt_nKkJ8CFfll701Zrw9N6k&si=c0d1GLRChrOKtkbK",
        iTunes: "https://music.apple.com/us/album/wings-of-fire-ep/1812163266"
      },
      boomplayEmbed: "https://www.boomplay.com/embed/110140275/COL",
      artistInfo: "Triad of Angels is a flagship band under ToA Studios, known for their cinematic pop sound that blends powerful vocals with orchestral elements. *Wings of Fire* showcases their signature style, weaving themes of hope, strength, and fiery passion."
    },
    {
      id: "ascend",
      title: "Ascend",
      artist: "PIPIKA",
      genre: "Cinematic Pop",
      year: 2025,
      cover: "assets/images/albums/ascend-album.png",
      tracks: ["Ascension", "Skyward Bound", "Celestial Rise"],
      links: {
        spotify: "https://open.spotify.com/album/5EetoHOZzPFoLGfM7XzTim?si=cWzTT5jKQ5KI-KkQYubADQ",
        appleMusic: "https://music.apple.com/us/album/ascend/1812603057",
        amazonMusic: "https://music.amazon.com/albums/B0F7H65CHH?marketplaceId=A15PK738MTQHSO&musicTerritory=AU&ref=dm_sh_8rBuhB66DVXsHWGPokhzw88DN",
        iHeartRadio: "https://www.iheart.com/artist/triad-of-angels-46655903/albums/ascend-327002587/",
        boomplay: "https://www.boomplay.com/albums/110238502?from=search&srModel=COPYLINK&srList=WEB",
        deezer: "https://dzr.page.link/M4d8bxxmmQdLEr3o7",
        youTubeMusic: "https://music.youtube.com/playlist?list=OLAK5uy_n6axY2s6JOnfyXOqSsWQ9o1Rmz05azC4w&si=5HJAAMnu0iXVlpNb",
        iTunes: "https://music.apple.com/us/album/ascend/1812603057"
      },
      boomplayEmbed: "https://www.boomplay.com/embed/110238502/COL",
      artistInfo: "Triad of Angels is a flagship band under ToA Studios, known for their cinematic pop sound that blends powerful vocals with orchestral elements. *Ascend* takes listeners on a journey of uplifting melodies and soaring emotions."
    },
    {
      id: "probed-and-confused",
      title: "Probed & Confused",
      artist: "ToA Studios",
      genre: "Electronic",
      year: 2025,
      cover: "assets/images/albums/probedandconfused-album.jpeg",
      tracks: ["First Contact", "Lost in the Void", "Abduction Anthem"],
      links: {
        spotify: "https://open.spotify.com/album/5pdZRwo8VXH3sxTZzqsUjN?si=nDt0mqEjQ82k-TaymTQYZQ",
        appleMusic: "https://music.apple.com/us/album/probed-confused/1812599708",
        amazonMusic: "https://music.amazon.com/albums/B0F7H6DL4J?marketplaceId=A15PK738MTQHSO&musicTerritory=AU&ref=dm_sh_72nUB1xSWdSCwKH8CX7EColXP",
        iHeartRadio: "https://www.iheart.com/artist/toa-studios-46720429/albums/probed-confused-327006359/",
        boomplay: "https://www.boomplay.com/albums/110242229?from=search&srModel=COPYLINK&srList=WEB",
        deezer: "https://dzr.page.link/UgaQkHSdvSTSWf7Y8",
        youTubeMusic: "https://music.youtube.com/playlist?list=OLAK5uy_nZawrRr1jGQNAw3nz0P2B-OoqMKmEn1Tg&si=v-I7avviDAjL1VW0",
        iTunes: "https://music.apple.com/us/album/probed-confused/1812599708"
      },
      boomplayEmbed: "https://www.boomplay.com/embed/110242229/COL",
      artistInfo: "ToA Studios explores the unknown with *Probed & Confused*, an electronic journey through cosmic confusion and extraterrestrial vibes."
    },
    {
      id: "echoes-on-the-dirt-road",
      title: "Echoes on the Dirt Road",
      artist: "ToA Studios",
      genre: "Country",
      year: 2025,
      cover: "assets/images/albums/echoesonthedirtroad-album.png",
      tracks: ["Dirt Road Echoes", "Whispers in the Wind", "Fading Footprints"],
      links: {
        spotify: "https://open.spotify.com/album/0y1rCdAJggJMoFvX1FFKDe?si=Vo8Gj9uXSku2-6WzY6HgQg",
        appleMusic: "https://music.apple.com/us/album/echoes-on-the-dirt-road/1812611626",
        amazonMusic: "https://music.amazon.com/albums/B0F7H6LXVZ?marketplaceId=A15PK738MTQHSO&musicTerritory=AU&ref=dm_sh_iqGT0j3cMSEGDIQiC59dy6977",
        iHeartRadio: "https://www.iheart.com/artist/toa-studios-46720429/albums/echoes-on-the-dirt-road-327006297/",
        boomplay: "https://www.boomplay.com/albums/110238994?from=search&srModel=COPYLINK&srList=WEB",
        deezer: "https://dzr.page.link/g2169XseSm3paGi38",
        youTubeMusic: "https://music.youtube.com/playlist?list=OLAK5uy_mL9FznTyx_-6nKq_rm767o73cjLlUCl_g&si=oprCNIO-vF3nwcuH",
        iTunes: "https://music.apple.com/us/album/echoes-on-the-dirt-road/1812611626"
      },
      boomplayEmbed: "https://www.boomplay.com/embed/110238994/COL",
      artistInfo: "ToA Studios presents *Echoes on the Dirt Road*, a heartfelt country album capturing the soul of rural life with hauntingly beautiful melodies."
    },
    {
      id: "phoenix-rising",
      title: "Phoenix Rising",
      artist: "ToA Studios",
      genre: "Orchestral",
      year: 2025,
      cover: "assets/images/albums/phoenixrising-album.png",
      tracks: ["Ashes to Flame", "Wings of Rebirth", "Eternal Ascent"],
      links: {
        spotify: "https://open.spotify.com/album/5xqK1MMJrhPOcPM58zjlvE?si=mn6Yx15fQkGzTLKPOPNE7Q",
        appleMusic: "https://music.apple.com/us/album/phoenix-rising/1812648146",
        amazonMusic: "https://music.amazon.com/albums/B0F7HKT32B?marketplaceId=A15PK738MTQHSO&musicTerritory=AU&ref=dm_sh_2uGXo9FM5fP0z0IDqTunHMEFQ",
        iHeartRadio: "https://www.iheart.com/artist/toa-studios-46720429/albums/phoenix-rising-327032664/",
        boomplay: "https://www.boomplay.com/albums/110247179?from=search&srModel=COPYLINK&srList=WEB",
        deezer: "https://dzr.page.link/wpiRxBm7aijHYBts7",
        youTubeMusic: "https://music.youtube.com/playlist?list=OLAK5uy_mcj1x0UNnDOgYxEpw_3dsQWykLrAOPXj4&si=lzimoRyOpANWfQAb",
        iTunes: "https://music.apple.com/us/album/phoenix-rising/1812648146"
      },
      boomplayEmbed: "https://www.boomplay.com/embed/110247179/COL",
      artistInfo: "ToA Studios delivers *Phoenix Rising*, an orchestral masterpiece symbolizing renewal and resilience through soaring compositions."
    },
    {
      id: "the-quiet-war",
      title: "The Quiet War",
      artist: "ToA Studios",
      genre: "Soundtrack",
      year: 2025,
      cover: "assets/images/albums/thequietwar-album.png",
      tracks: ["Silent Conflict", "Shadows of Valor", "Echoes of Peace"],
      links: {
        spotify: "https://open.spotify.com/album/5grqzzq1V4Gaw3jqDjoQbV?si=7YUpINOaRmaKSuYdtlVzvQ",
        appleMusic: "https://music.apple.com/us/album/the-quiet-war/1812870604",
        amazonMusic: "https://music.amazon.com/albums/B0F7LTGSTV?marketplaceId=A15PK738MTQHSO&musicTerritory=AU&ref=dm_sh_Kd4MIeBYuzAoFY3yaobhY11t6",
        iHeartRadio: "https://www.iheart.com/artist/toa-studios-46720429/albums/the-quiet-war-327214148/",
        boomplay: "https://www.boomplay.com/albums/110301296?from=search&srModel=COPYLINK&srList=WEB",
        deezer: "https://dzr.page.link/W8dvTRvGoCzDwxc98",
        youTubeMusic: "https://music.youtube.com/playlist?list=OLAK5uy_mnAyAE1pxoey93kvk6KxqaY8n3CDJtD-0&si=RdO6K4pEyqJVxWQ-",
        iTunes: "https://music.apple.com/us/album/the-quiet-war/1812870604"
      },
      boomplayEmbed: "https://www.boomplay.com/embed/110301296/COL",
      artistInfo: "ToA Studios crafts *The Quiet War*, a gripping soundtrack for an untold story of inner battles and silent victories."
    },
    {
      id: "reality-exe",
      title: "Reality.exe",
      artist: "ToA Studios",
      genre: "Electronic",
      year: 2025,
      cover: "assets/images/albums/reality-exe-album.png",
      tracks: ["Code of Existence", "Digital Pulse", "System Reboot"],
      links: {
        spotify: "https://open.spotify.com/album/6SzYfretgTzLUITlIP6AMy?si=f2cObGo4STKF-YQusk5YGg",
        appleMusic: "https://music.apple.com/us/album/reality-exe/1812900765",
        amazonMusic: "https://music.amazon.com/albums/B0F7M1HTYD?marketplaceId=A15PK738MTQHSO&musicTerritory=AU&ref=dm_sh_HpaPCWwzNgVC3Y7pxhTXOJQqW",
        iHeartRadio: "https://www.iheart.com/artist/toa-studios-46720429/albums/realityexe-327233858/",
        boomplay: "https://www.boomplay.com/albums/110303684?from=search&srModel=COPYLINK&srList=WEB",
        deezer: "https://dzr.page.link/nSpcy613QhmzKCi7A",
        youTubeMusic: "https://music.youtube.com/playlist?list=OLAK5uy_mEUI3xipOKn-zGt9dOHJbIuk6e1J7gHLQ&si=UuVUiJ6uhXTmNmR_",
        iTunes: "https://music.apple.com/us/album/reality-exe/1812900765"
      },
      boomplayEmbed: "https://www.boomplay.com/embed/110303684/COL",
      artistInfo: "ToA Studios reboots reality with *Reality.exe*, an electronic album that glitches through the fabric of existence with pulsating beats."
    },
    {
      id: "serpents-veil",
      title: "Serpent's Veil",
      artist: "ToA Studios",
      genre: "Rock, Metal, Heavy, Alternative",
      year: "19th of May, 2025",
      cover: "assets/images/albums/serpentsveil-album.png",
      tracks: [""],
      links: {
        spotify: "",
        appleMusic: "",
        amazonMusic: "",
        iHeartRadio: "",
        boomplay: "",
        deezer: "",
        youTubeMusic: "",
        iTunes: "https://music.apple.com/au/album/serpents-veil/1813142997"
      },
      boomplayEmbed: "",
      artistInfo: ""
    },
    {
      id: "american-firestorm-songs-of-freedom",
      title: "American Firestorm Songs of Freedom",
      artist: "ToA Studios",
      genre: "Country, Ballad, Funk, Classical, Alternative, Pop",
      year: "20th of June, 2025",
      cover: "assets/images/albums/songsoffreedom-album.png",
      tracks: [""],
      links: {
        spotify: "",
        appleMusic: "",
        amazonMusic: "",
        iHeartRadio: "",
        boomplay: "",
        deezer: "",
        youTubeMusic: "",
        iTunes: "https://music.apple.com/au/album/american-firestorm-songs-of-freedom/1813521823"
      },
      boomplayEmbed: "",
      artistInfo: ""
    },
  ];

  // Function to populate the page with album data
  document.addEventListener('DOMContentLoaded', () => {
    try {
      // Get album ID from query parameter
      const urlParams = new URLSearchParams(window.location.search);
      const albumId = urlParams.get('id');
      console.log('Album ID from URL:', albumId);

      if (!albumId) {
        throw new Error('No album ID provided in the URL.');
      }

      // Find the album in the data
      const album = albums.find(a => a.id === albumId);
      if (!album) {
        throw new Error(`Album with ID "${albumId}" not found.`);
      }
      console.log('Found album:', album);

      // Update Album Background
      const backgroundImg = document.getElementById('album-background');
      backgroundImg.src = album.cover;
      backgroundImg.onerror = () => {
        console.error(`Failed to load background image: ${album.cover}`);
        backgroundImg.style.display = 'none';
      };
      document.getElementById('album-title').textContent = album.title;
      document.getElementById('album-subtitle').textContent = `A ${album.genre} Masterpiece by ${album.artist}`;

      // Update Album Details
      const coverImg = document.getElementById('album-cover');
      coverImg.src = album.cover;
      coverImg.alt = `${album.title} album cover`;
      coverImg.onerror = () => {
        console.error(`Failed to load album cover image: ${album.cover}`);
        coverImg.src = 'assets/images/placeholder-album.png';
      };
      document.getElementById('album-info-title').textContent = album.title;
      document.getElementById('album-artist').innerHTML = `<strong>Artist:</strong> ${album.artist}`;
      document.getElementById('album-tracks').innerHTML = `<strong>Tracks:</strong> ${album.tracks.join(', ')}`;
      document.getElementById('album-genre').innerHTML = `<strong>Genre:</strong> ${album.genre}`;
      document.getElementById('album-year').innerHTML = `<strong>Release Date:</strong> ${album.year}`;
      document.getElementById('album-description').textContent = album.artistInfo || "No description available.";

      // Update Streaming Links
      const linkTabs = document.getElementById('link-tabs');
      const platforms = [
        { name: 'Spotify', key: 'spotify' },
        { name: 'Apple Music', key: 'appleMusic' },
        { name: 'Amazon Music', key: 'amazonMusic' },
        { name: 'iHeartRadio', key: 'iHeartRadio' },
        { name: 'Boomplay', key: 'boomplay' },
        { name: 'Deezer', key: 'deezer' },
        { name: 'YouTube Music', key: 'youTubeMusic' },
        { name: 'iTunes', key: 'iTunes' }
      ];

      platforms.forEach(platform => {
        const link = album.links[platform.key];
        if (link && link !== '') {
          const a = document.createElement('a');
          a.href = link;
          a.target = '_blank';
          a.rel = 'noopener';
          a.className = 'link-tab';
          a.setAttribute('aria-label', `Stream on ${platform.name}`);
          a.textContent = platform.name;
          linkTabs.appendChild(a);
        }
      });

      // Update Music Player Embed
      const musicPlayerEmbed = document.getElementById('music-player-embed');
      if (album.boomplayEmbed && album.boomplayEmbed !== '') {
        const iframe = document.createElement('iframe');
        iframe.src = album.boomplayEmbed;
        iframe.width = '600';
        iframe.height = '600';
        iframe.frameBorder = '0';
        musicPlayerEmbed.appendChild(iframe);
      } else {
        musicPlayerEmbed.innerHTML = '<p>No music player available for this album.</p>';
      }

      // Initialize Comments Section
      initializeComments(albumId);
    } catch (error) {
      console.error('Error loading album data:', error.message);
      displayError(
        "Error Loading Album",
        `We couldn‚Äôt load this album. Please try again later or <a href='music.html'>go back to the Music page</a>. Error: ${error.message}`
      );
    }
  });

  function displayError(title, subtitle) {
    document.getElementById('album-title').innerHTML = title;
    document.getElementById('album-subtitle').innerHTML = subtitle;
    document.getElementById('album-background').style.display = 'none';
    document.querySelector('.album-details').style.display = 'none';
    document.querySelector('.streaming-links').style.display = 'none';
    document.querySelector('.music-player').style.display = 'none';
    document.querySelector('.comments-section').style.display = 'none';

    const main = document.querySelector('.album-main');
    const errorContainer = document.createElement('section');
    errorContainer.className = 'error-section';
    errorContainer.innerHTML = `
      <h2>${title}</h2>
      <p>${subtitle}</p>
    `;
    main.appendChild(errorContainer);
  }

  // === Comments Section Logic ===
  // Utility Functions
  const sanitizeInput = (text) => {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML
      .replace(/&/g, '&')
      .replace(/</g, '<')
      .replace(/>/g, '>')
      .replace(/"/g, '"')
      .replace(/'/g, '');
  };

  class RateLimiter {
    constructor(limit = 5, windowMs = 600000) { // 5 comments per 10 minutes
      this.limit = limit;
      this.windowMs = windowMs;
      this.requests = JSON.parse(sessionStorage.getItem(`commentRateLimit_${this.getUserId() || 'anonymous'}`)) || [];
    }

    getUserId() {
      const cachedAuth = sessionStorage.getItem('authState');
      if (cachedAuth) {
        try {
          const user = JSON.parse(cachedAuth);
          return user.uid;
        } catch (e) {
          console.warn('Invalid cached auth state:', e);
        }
      }
      return null;
    }

    canPost() {
      const now = Date.now();
      this.requests = this.requests.filter(timestamp => now - timestamp < this.windowMs);
      if (this.requests.length >= this.limit) return false;
      this.requests.push(now);
      sessionStorage.setItem(`commentRateLimit_${this.getUserId() || 'anonymous'}`, JSON.stringify(this.requests));
      return true;
    }

    getRemainingTime() {
      const now = Date.now();
      const oldestRequest = this.requests[0] || now;
      return Math.max(0, this.windowMs - (now - oldestRequest));
    }
  }

  // Comments Manager
  class CommentsManager {
    constructor(albumId) {
      this.albumId = albumId;
      this.rateLimiter = new RateLimiter();
      this.commentList = document.getElementById('comment-list');
      this.commentInput = document.getElementById('comment-input');
      this.submitButton = document.getElementById('submit-comment');

      // Debugging: Check elements
      if (!this.commentList) console.error('Comment list element not found. Check ID: comment-list');
      if (!this.commentInput) console.error('Comment input element not found. Check ID: comment-input');
      if (!this.submitButton) console.error('Submit button not found. Check ID: submit-comment');

      this.setupEventListeners();
      this.updateUI(null, null);
      this.renderComments();
    }

    setupEventListeners() {
      this.submitButton.addEventListener('click', () => this.postComment());
      this.commentList.addEventListener('click', (e) => this.handleCommentAction(e));

      // Listen for auth state changes
      onAuthStateChanged(auth, async (user) => {
        let userData = null;
        if (user) {
          try {
            const userDoc = await getDoc(doc(db, 'users', user.uid));
            userData = userDoc.exists() ? userDoc.data() : {};
          } catch (error) {
            console.error('Error fetching user data:', error);
            userData = { username: user.displayName || user.email || 'User' };
          }
        }
        console.log('Auth state changed:', user ? `Logged in as ${userData?.username || user?.displayName || user?.email}` : 'No user');
        this.updateUI(user, userData);
        this.renderComments();
      });
    }

    updateUI(user, userData) {
      if (user) {
        this.commentInput.disabled = false;
        this.submitButton.disabled = false;
      } else {
        this.commentInput.disabled = true;
        this.submitButton.disabled = true;
      }
    }

    async postComment() {
      const content = this.commentInput.value.trim();
      if (!content) {
        alert('Please enter a comment.');
        return;
      }

      if (!auth.currentUser) {
        alert('Please sign in to post a comment.');
        const loginBtn = document.getElementById('global-login-btn');
        if (loginBtn) loginBtn.click();
        return;
      }

      if (!this.rateLimiter.canPost()) {
        const waitTime = Math.ceil(this.rateLimiter.getRemainingTime() / 1000);
        alert(`Please wait ${waitTime} seconds before posting another comment.`);
        return;
      }

      try {
        const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
        const userData = userDoc.exists() ? userDoc.data() : {};
        const comment = {
          uid: auth.currentUser.uid,
          username: userData.username || auth.currentUser.displayName || auth.currentUser.email || 'User',
          content: sanitizeInput(content),
          timestamp: new Date().toISOString(),
          likes: 0,
          dislikes: 0,
          likedBy: [],
          dislikedBy: []
        };

        await addDoc(collection(db, `albums/${this.albumId}/comments`), comment);
        this.commentInput.value = '';
        this.renderComments();
      } catch (error) {
        console.error('Error posting comment:', error);
        alert('Failed to post comment. Please check your network or try again.');
      }
    }

    async handleCommentAction(e) {
      const target = e.target;
      if (!target.classList.contains('action-btn')) return;

      const commentId = target.dataset.commentId;
      const action = target.dataset.action;

      if (!auth.currentUser) {
        alert(`Please sign in to ${action} comments.`);
        const loginBtn = document.getElementById('global-login-btn');
        if (loginBtn) loginBtn.click();
        return;
      }

      try {
        const commentRef = doc(db, `albums/${this.albumId}/comments`, commentId);
        const commentDoc = await getDoc(commentRef);
        if (!commentDoc.exists()) return;
        let comment = commentDoc.data();

        if (action === 'like') {
          const userId = auth.currentUser.uid;
          if (comment.likedBy.includes(userId)) {
            comment.likedBy = comment.likedBy.filter(u => u !== userId);
            comment.likes--;
          } else {
            comment.likedBy.push(userId);
            comment.likes++;
            if (comment.dislikedBy.includes(userId)) {
              comment.dislikedBy = comment.dislikedBy.filter(u => u !== userId);
              comment.dislikes--;
            }
          }
          await updateDoc(commentRef, {
            likes: comment.likes,
            likedBy: comment.likedBy,
            dislikes: comment.dislikes,
            dislikedBy: comment.dislikedBy
          });
        } else if (action === 'dislike') {
          const userId = auth.currentUser.uid;
          if (comment.dislikedBy.includes(userId)) {
            comment.dislikedBy = comment.dislikedBy.filter(u => u !== userId);
            comment.dislikes--;
          } else {
            comment.dislikedBy.push(userId);
            comment.dislikes++;
            if (comment.likedBy.includes(userId)) {
              comment.likedBy = comment.likedBy.filter(u => u !== userId);
              comment.likes--;
            }
          }
          await updateDoc(commentRef, {
            likes: comment.likes,
            likedBy: comment.likedBy,
            dislikes: comment.dislikes,
            dislikedBy: comment.dislikedBy
          });
        } else if (action === 'delete' && auth.currentUser.email === 'admin@triadofangels.com') {
          await deleteDoc(commentRef);
        }

        this.renderComments();
      } catch (error) {
        console.error(`Error performing ${action} action:`, error);
        alert(`Failed to ${action} comment. Please try again.`);
      }
    }

    async renderComments() {
      this.commentList.innerHTML = '';
      try {
        const q = query(collection(db, `albums/${this.albumId}/comments`), orderBy('timestamp', 'desc'));
        const querySnapshot = await getDocs(q);
        querySnapshot.forEach((doc) => {
          const comment = doc.data();
          const commentDiv = document.createElement('div');
          commentDiv.className = 'comment';

          const header = document.createElement('div');
          header.className = 'comment-header';
          header.innerHTML = `
            <span>${comment.username}</span>
            <span class="timestamp">${new Date(comment.timestamp).toLocaleString()}</span>
          `;

          const content = document.createElement('div');
          content.className = 'comment-content';
          content.textContent = comment.content;

          const actions = document.createElement('div');
          actions.className = `comment-actions ${auth.currentUser && auth.currentUser.email === 'admin@triadofangels.com' ? 'admin-view' : ''}`;
          actions.innerHTML = `
            <button class="action-btn" data-comment-id="${doc.id}" data-action="like" ${!auth.currentUser ? 'disabled' : ''}>
              üëç
            </button>
            <span>${comment.likes}</span>
            <button class="action-btn admin-only" data-comment-id="${doc.id}" data-action="dislike" ${!auth.currentUser ? 'disabled' : ''}>
              üëé
            </button>
            <span class="admin-only">${comment.dislikes}</span>
            ${auth.currentUser && auth.currentUser.email === 'admin@triadofangels.com' ? `<button class="action-btn admin-only" data-comment-id="${doc.id}" data-action="delete">Delete</button>` : ''}
          `;

          commentDiv.appendChild(header);
          commentDiv.appendChild(content);
          commentDiv.appendChild(actions);
          this.commentList.appendChild(commentDiv);
        });
      } catch (error) {
        console.error('Error rendering comments:', error);
        this.commentList.innerHTML = '<p>Failed to load comments. Please try again later.</p>';
      }
    }
  }

  function initializeComments(albumId) {
    new CommentsManager(albumId);
  }
</script>
</body>
</html>